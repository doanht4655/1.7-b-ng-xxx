var ocr=function(){"use strict";function Ee(e){return e}const Z=!1,q={equals:(e,t)=>e===t};let ee=B;const b=1,S=2;var I=null;let N=null,te=null,p=null,h=null,w=null,k=0;function j(e,t){t=t?Object.assign({},q,t):q;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},s=i=>(typeof i=="function"&&(i=i(n.value)),z(n,i));return[se.bind(n),s]}function ne(e){if(p===null)return e();const t=p;p=null;try{return e()}finally{p=t}}function se(){if(this.sources&&this.state)if(this.state===b)W(this);else{const e=h;h=null,T(()=>O(this)),h=e}if(p){const e=this.observers?this.observers.length:0;p.sources?(p.sources.push(this),p.sourceSlots.push(e)):(p.sources=[this],p.sourceSlots=[e]),this.observers?(this.observers.push(p),this.observerSlots.push(p.sources.length-1)):(this.observers=[p],this.observerSlots=[p.sources.length-1])}return this.value}function z(e,t,n){let s=e.value;return(!e.comparator||!e.comparator(s,t))&&(e.value=t,e.observers&&e.observers.length&&T(()=>{for(let i=0;i<e.observers.length;i+=1){const f=e.observers[i],c=N&&N.running;c&&N.disposed.has(f),(c?!f.tState:!f.state)&&(f.pure?h.push(f):w.push(f),f.observers&&G(f)),c||(f.state=b)}if(h.length>1e6)throw h=[],new Error})),t}function W(e){if(!e.fn)return;R(e);const t=k;re(e,e.value,t)}function re(e,t,n){let s;const i=I,f=p;p=I=e;try{s=e.fn(t)}catch(c){return e.pure&&(e.state=b,e.owned&&e.owned.forEach(R),e.owned=null),e.updatedAt=n+1,K(c)}finally{p=f,I=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?z(e,s):e.value=s,e.updatedAt=n)}function Y(e){if(e.state===0)return;if(e.state===S)return O(e);if(e.suspense&&ne(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<k);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===b)W(e);else if(e.state===S){const s=h;h=null,T(()=>O(e,t[0])),h=s}}function T(e,t){if(h)return e();let n=!1;h=[],w?n=!0:w=[],k++;try{const s=e();return oe(n),s}catch(s){n||(w=null),h=null,K(s)}}function oe(e){if(h&&(B(h),h=null),e)return;const t=w;w=null,t.length&&T(()=>ee(t))}function B(e){for(let t=0;t<e.length;t++)Y(e[t])}function O(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const s=e.sources[n];if(s.sources){const i=s.state;i===b?s!==t&&(!s.updatedAt||s.updatedAt<k)&&Y(s):i===S&&O(s,t)}}}function G(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=S,n.pure?h.push(n):w.push(n),n.observers&&G(n))}}function R(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),s=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){const f=i.pop(),c=n.observerSlots.pop();s<i.length&&(f.sourceSlots[c]=s,i[s]=f,n.observerSlots[s]=c)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)R(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)R(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function ie(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function K(e,t=I){throw ie(e)}async function ae(e,t,n){if(!e()||e().enabled===!1||e().options[n].active===!1)return!1;function s(d){return d.replace(/^https?:\/\/(www\.)?/,"")}const i=t(),f=s(i);return!e().blacklist.some(d=>{const u=s(d);return f===u})}const le={matches:["<all_urls>"],allFrames:!0,async main(){let e;try{e=window.top.document.location.href}catch{e=window.location.href}const[t]=j(e),[n,s]=j(await chrome.storage.local.get("settings"));if(s(n().settings),!await ae(n,t,"OCR"))return;let c=null,d,u=null,M=null,$=null,E="";async function D(){return new Promise((r,l)=>{chrome.storage.local.get(["settings"],a=>{chrome.runtime.lastError?l(chrome.runtime.lastError.message):r(a.settings)})})}let o=await D();chrome.runtime.onMessage.addListener(async(r,l,a)=>{r.picker==="ocrPicker"?(E="ocrPicker",o=await D(),u=o.options.OCR.ocrId,document.body.addEventListener("mouseover",y,!1),document.body.addEventListener("click",_,!1)):r.picker==="inputPicker"?(E="inputPicker",o=await D(),u=o.options.OCR.ocrId,document.body.addEventListener("mouseover",y,!1),document.body.addEventListener("click",_,!1)):r.menuItemId&&(u=r.menuItemId,o={...o,OCR:{...o.options.OCR,ocrId:r.menuItemId}},await chrome.storage.local.set({settings:{...o}}).then(m=>{chrome.storage.local.get(null,function(g){})}))});function y(r){if(!u){J("Please select an OCR ID first",3e3),document.body.removeEventListener("mouseover",y);return}c&&(c.style.outline="",d&&document.body.removeChild(d)),c=r.target,c.style.outline="2px solid red",d=document.createElement("div"),d.style.position="fixed",d.style.zIndex="10000",d.style.backgroundColor="white",d.style.border="1px solid black",d.style.padding="5px",d.style.maxWidth="300px",d.style.fontSize="small",d.style.top="0",d.style.right="0",d.textContent=c.outerHTML,document.body.appendChild(d)}async function _(r){if(!u){J("Please select an OCR ID first",3e3),document.body.removeEventListener("mouseover",y);return}r.stopPropagation(),r.preventDefault(),document.body.removeEventListener("mouseover",y),E==="ocrPicker"?(o.options.OCR.ocrtype[u].ocrImage=null,o.options.OCR.ocrtype[u].ocrImage=A(c),await chrome.storage.local.set({settings:{...o,OCR:{...o.options.OCR,ocrtype:{...o.options.OCR.ocrtype,[u]:{...o.options.OCR.ocrtype[u],ocrImage:A(c)}}}}}).then(l=>{chrome.storage.local.get(null,function(a){})})):E==="inputPicker"&&(o.options.OCR.ocrtype[u].inputElement=A(c),await chrome.storage.local.set({settings:{...o,OCR:{...o.options.OCR,ocrtype:{...o.options.OCR.ocrtype,[u]:{...o.options.OCR.ocrtype[u],inputElement:A(c)}}}}}).then(l=>{chrome.storage.local.get(null,function(a){})})),c&&(c.style.outline="",c=null,document.body.removeChild(d),d=null,document.body.removeEventListener("click",_))}function A(r){if(!(r instanceof Element))return"";const l=[];for(;r!=null&&r.nodeType===Node.ELEMENT_NODE;){let a=r.nodeName.toLowerCase();if(r.id){a+=`#${r.id}`,l.unshift(a);break}else{let m=r,g=1;for(;m=m.previousElementSibling;)m.nodeName.toLowerCase()===a&&g++;g!==1&&(a+=`:nth-of-type(${g})`)}l.unshift(a),r=r.parentNode}return l.join(" > ")}function H(r){return document.querySelector(r)}const J=(r,l)=>{const a=document.createElement("div");a.style.cssText="position:fixed;top:10%;left:0;background-color:rgba(0,0,0,.8);border-radius:4px;padding:16px;color:#fff;font:calc(14px + .5vw) 'Arial',sans-serif;font-weight:bold;text-transform:uppercase;letter-spacing:1px;z-index:9999;transition:all 1s;animation:slideIn 1s forwards",a.innerHTML=r,document.body.appendChild(a);const m=document.createElement("style");m.innerHTML="@keyframes slideIn{0%{transform:translateX(-100%)}100%{transform:translateX(0)}}@keyframes slideOut{0%{transform:translateX(0)}100%{transform:translateX(100%)}}",document.head.appendChild(m),setTimeout(()=>{a.style.animation="slideOut 1s forwards",setTimeout(()=>{document.body.removeChild(a)},1e3)},l)};function fe(r){return new Promise(l=>setTimeout(l,r))}function pe(){return new Promise((r,l)=>{let a=new Image;a.crossOrigin="anonymous",a.src=M.src,a.onload=function(){let m=document.createElement("canvas");m.width=a.width,m.height=a.height,m.getContext("2d").drawImage(a,0,0);let V=m.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,"");r(V)},a.onerror=function(){l(new Error("Failed to load image"))}})}async function he(r){if(u)try{return await(await fetch(`https://${o.PLANTYPE}.nocaptchaai.com/solve`,{method:"POST",headers:{"Content-Type":"application/json",apikey:o.APIKEY},body:JSON.stringify({method:"OCR",id:u,image:r,softid:`chromeExt_V${o.version_data.local}`})})).json()}catch{}}async function me(r,l){r.value="";function a(v,C,ve){const be=new C(ve);v.dispatchEvent(be)}function m(v){["mouseover","mousedown","mouseup","click"].forEach(C=>{a(v,MouseEvent,{bubbles:!0,cancelable:!0,view:window,type:C})})}function g(v){return new Promise(C=>setTimeout(C,v))}m(r),a(r,FocusEvent,{bubbles:!0,cancelable:!0,type:"focus"});const Q=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,view:window,key:l,code:`Digit${l}`,location:0}),V=new KeyboardEvent("keypress",{bubbles:!0,cancelable:!0,view:window,key:l,code:`Digit${l}`,location:0}),we=new KeyboardEvent("keyup",{bubbles:!0,cancelable:!0,view:window,key:l,code:`Digit${l}`,location:0});r.dispatchEvent(Q),await g(Math.random()*100+50);try{r.dispatchEvent(V),r.value=l,r.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}await g(Math.random()*100+50),r.dispatchEvent(we)}async function ge(){let r=await pe(),l=await he(r);await me($,l.solution)}for(;!o.blacklist.includes(t());)await fe(3e3),o.options.OCR.autoSolve==!0&&u!=null&&o.options.OCR.ocrtype[u].ocrImage&&o.options.OCR.ocrtype[u].inputElement&&(M=H(o.options.OCR.ocrtype[u].ocrImage),$=H(o.options.OCR.ocrtype[u].inputElement),await ge(),c=null,d=null,u=null,M=null,$=null,E="",o={...o,OCR:{...o.options.OCR,ocrId:null}},await chrome.storage.local.set({settings:{...o}}).then(r=>{chrome.storage.local.get(null,function(l){})}))}},X=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;function x(e,...t){}const ce={debug:(...e)=>x(console.debug,...e),log:(...e)=>x(console.log,...e),warn:(...e)=>x(console.warn,...e),error:(...e)=>x(console.error,...e)};class U extends Event{constructor(t,n){super(U.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=n}static EVENT_NAME=F("wxt:locationchange")}function F(e){return`${X?.runtime?.id}:ocr:${e}`}function ue(e){let t,n;return{run(){t==null&&(n=new URL(location.href),t=e.setInterval(()=>{let s=new URL(location.href);s.href!==n.href&&(window.dispatchEvent(new U(s,n)),n=s)},1e3))}}}class L{constructor(t,n){this.contentScriptName=t,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}static SCRIPT_STARTED_MESSAGE_TYPE=F("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=ue(this);receivedMessageIds=new Set;get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return X.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,n){const s=setInterval(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearInterval(s)),s}setTimeout(t,n){const s=setTimeout(()=>{this.isValid&&t()},n);return this.onInvalidated(()=>clearTimeout(s)),s}requestAnimationFrame(t){const n=requestAnimationFrame((...s)=>{this.isValid&&t(...s)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(t,n){const s=requestIdleCallback((...i)=>{this.signal.aborted||t(...i)},n);return this.onInvalidated(()=>cancelIdleCallback(s)),s}addEventListener(t,n,s,i){n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),t.addEventListener?.(n.startsWith("wxt:")?F(n):n,s,{...i,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),ce.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:L.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(t){const n=t.data?.type===L.SCRIPT_STARTED_MESSAGE_TYPE,s=t.data?.contentScriptName===this.contentScriptName,i=!this.receivedMessageIds.has(t.data?.messageId);return n&&s&&i}listenForNewerScripts(t){let n=!0;const s=i=>{if(this.verifyScriptStartedEvent(i)){this.receivedMessageIds.add(i.data.messageId);const f=n;if(n=!1,f&&t?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",s),this.onInvalidated(()=>removeEventListener("message",s))}}function Se(){}function P(e,...t){}const de={debug:(...e)=>P(console.debug,...e),log:(...e)=>P(console.log,...e),warn:(...e)=>P(console.warn,...e),error:(...e)=>P(console.error,...e)};return(async()=>{try{const{main:e,...t}=le,n=new L("ocr",t);return await e(n)}catch(e){throw de.error('The content script "ocr" crashed on startup!',e),e}})()}();
ocr;
