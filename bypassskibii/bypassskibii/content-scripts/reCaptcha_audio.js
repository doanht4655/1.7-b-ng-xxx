var recaptchaaudio=function(){"use strict";function ft(t){return t}const W=!1,P={equals:(t,e)=>t===e};let Y=L;const m=1,v=2;var S=null;let q=null,G=null,a=null,o=null,h=null,b=0;function x(t,e){e=e?Object.assign({},P,e):P;const r={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},s=n=>(typeof n=="function"&&(n=n(r.value)),M(r,n));return[K.bind(r),s]}function z(t){if(a===null)return t();const e=a;a=null;try{return t()}finally{a=e}}function K(){if(this.sources&&this.state)if(this.state===m)O(this);else{const t=o;o=null,y(()=>E(this)),o=t}if(a){const t=this.observers?this.observers.length:0;a.sources?(a.sources.push(this),a.sourceSlots.push(t)):(a.sources=[this],a.sourceSlots=[t]),this.observers?(this.observers.push(a),this.observerSlots.push(a.sources.length-1)):(this.observers=[a],this.observerSlots=[a.sources.length-1])}return this.value}function M(t,e,r){let s=t.value;return(!t.comparator||!t.comparator(s,e))&&(t.value=e,t.observers&&t.observers.length&&y(()=>{for(let n=0;n<t.observers.length;n+=1){const i=t.observers[n],l=q&&q.running;l&&q.disposed.has(i),(l?!i.tState:!i.state)&&(i.pure?o.push(i):h.push(i),i.observers&&V(i)),l||(i.state=m)}if(o.length>1e6)throw o=[],new Error})),e}function O(t){if(!t.fn)return;A(t);const e=b;j(t,t.value,e)}function j(t,e,r){let s;const n=S,i=a;a=S=t;try{s=t.fn(e)}catch(l){return t.pure&&(t.state=m,t.owned&&t.owned.forEach(A),t.owned=null),t.updatedAt=r+1,$(l)}finally{a=i,S=n}(!t.updatedAt||t.updatedAt<=r)&&(t.updatedAt!=null&&"observers"in t?M(t,s):t.value=s,t.updatedAt=r)}function _(t){if(t.state===0)return;if(t.state===v)return E(t);if(t.suspense&&z(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<b);)t.state&&e.push(t);for(let r=e.length-1;r>=0;r--)if(t=e[r],t.state===m)O(t);else if(t.state===v){const s=o;o=null,y(()=>E(t,e[0])),o=s}}function y(t,e){if(o)return t();let r=!1;o=[],h?r=!0:h=[],b++;try{const s=t();return Q(r),s}catch(s){r||(h=null),o=null,$(s)}}function Q(t){if(o&&(L(o),o=null),t)return;const e=h;h=null,e.length&&y(()=>Y(e))}function L(t){for(let e=0;e<t.length;e++)_(t[e])}function E(t,e){t.state=0;for(let r=0;r<t.sources.length;r+=1){const s=t.sources[r];if(s.sources){const n=s.state;n===m?s!==e&&(!s.updatedAt||s.updatedAt<b)&&_(s):n===v&&E(s,e)}}}function V(t){for(let e=0;e<t.observers.length;e+=1){const r=t.observers[e];r.state||(r.state=v,r.pure?o.push(r):h.push(r),r.observers&&V(r))}}function A(t){let e;if(t.sources)for(;t.sources.length;){const r=t.sources.pop(),s=t.sourceSlots.pop(),n=r.observers;if(n&&n.length){const i=n.pop(),l=r.observerSlots.pop();s<n.length&&(i.sourceSlots[l]=s,n[s]=i,r.observerSlots[s]=l)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)A(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)A(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function H(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function $(t,e=S){throw H(t)}async function J(t,e,r){if(!t()||t().enabled===!1||t().options[r].active===!1)return!1;function s(d){return d.replace(/^https?:\/\/(www\.)?/,"")}const n=e(),i=s(n);return!t().blacklist.some(d=>{const R=s(d);return i===R})}const X={matches:["<all_urls>"],allFrames:!0,async main(){let t;try{t=window.top.document.location.href}catch{t=window.location.href}const[e]=x(t),[r,s]=x(await chrome.storage.local.get("settings"));if(s(r().settings),!await J(r,e,"ReCaptcha"))return;r().logsEnabled;function l(c){return new Promise(u=>setTimeout(u,c))}async function d(c){if(!document.contains(c))return;const u=["mouseover","mousedown","mouseup","click"];for(const f of u){const p=document.createEvent("MouseEvents");p.initEvent(f,!0,!1),c.dispatchEvent(p)}}async function R(c,u,f){const w=await(await fetch(f)).arrayBuffer(),U=new Blob([w],{type:"audio/mp3"});return await rt(U,u)}function rt(c,u){return new Promise((f,p)=>{const w=new FileReader;w.onloadend=function(){const U=w.result;chrome.runtime.sendMessage({type:"networkRequest",payload:{url:"https://audio.nocaptchaai.com/solve",method:"POST",headers:{apikey:u},body:{audio:Array.from(new Uint8Array(U)),method:"rcaudio"},isFormData:!0}},g=>{if(!g)return p("No response from background.");g.success?f([g.data.solution,g.data.id]):p(g.error||"Request failed.")})},w.readAsArrayBuffer(c)})}const st=()=>document.querySelector(".recaptcha-checkbox")!==null;async function nt(){return!!document.querySelector(".recaptcha-checkbox")}const it=()=>document.querySelector(".rc-imageselect-instructions")!==null,at=()=>document.querySelector("#audio-instructions")!==null||document.querySelector(".rc-doscaptcha-header")!==null,N=()=>{const c=document.querySelector(".recaptcha-checkbox")?.getAttribute("aria-checked")==="true",u=document.querySelector("#recaptcha-verify-button")?.disabled;return c||u},ot=()=>document.querySelector(".rc-doscaptcha-header")?.innerText==="Try again later";async function ct(){!st()||N()||(await l(500),r().options.ReCaptcha.autoOpen&&d(document.querySelector("#recaptcha-anchor")))}async function lt(){N()||(await l(500),d(document.querySelector("#recaptcha-audio-button")))}async function ut(){if(r().options.ReCaptcha.autoSolve===!1||N()||ot())return;const c=document.querySelector(".rc-audiochallenge-tdownload-link")?.href||document.querySelector("#audio-source")?.src;document.querySelector("html")?.getAttribute("lang")?.trim();const u="https://audio.nocaptchaai.com/solve",[f,p]=await R(u,r().APIKEY,c);f&&(document.querySelector("#audio-response").value=f,await l(r().reCaptchaSubmitDelay*1e3),d(document.querySelector("#recaptcha-verify-button")))}async function D(c){return[...document.querySelectorAll(`iframe[src*="/recaptcha/api2/${c}"]`),...document.querySelectorAll(`iframe[src*="/recaptcha/enterprise/${c}"]`)].some(f=>window.getComputedStyle(f).visibility==="visible")}for(;r().PLANTYPE&&r().APIKEY&&r().enabled===!0&&r().options.ReCaptcha.active===!0&&r().options.ReCaptcha.solveType=="audio";)await l(2e3),await D("bframe"),await D("anchor"),await nt()&&r().options.ReCaptcha.autoOpen===!0?await ct():it()&&r().options.ReCaptcha.autoSolve==!0?await lt():at()&&await ut()}},B=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;function T(t,...e){}const Z={debug:(...t)=>T(console.debug,...t),log:(...t)=>T(console.log,...t),warn:(...t)=>T(console.warn,...t),error:(...t)=>T(console.error,...t)};class F extends Event{constructor(e,r){super(F.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=r}static EVENT_NAME=k("wxt:locationchange")}function k(t){return`${B?.runtime?.id}:reCaptcha_audio:${t}`}function tt(t){let e,r;return{run(){e==null&&(r=new URL(location.href),e=t.setInterval(()=>{let s=new URL(location.href);s.href!==r.href&&(window.dispatchEvent(new F(s,r)),r=s)},1e3))}}}class I{constructor(e,r){this.contentScriptName=e,this.options=r,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}static SCRIPT_STARTED_MESSAGE_TYPE=k("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=tt(this);receivedMessageIds=new Set;get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return B.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,r){const s=setInterval(()=>{this.isValid&&e()},r);return this.onInvalidated(()=>clearInterval(s)),s}setTimeout(e,r){const s=setTimeout(()=>{this.isValid&&e()},r);return this.onInvalidated(()=>clearTimeout(s)),s}requestAnimationFrame(e){const r=requestAnimationFrame((...s)=>{this.isValid&&e(...s)});return this.onInvalidated(()=>cancelAnimationFrame(r)),r}requestIdleCallback(e,r){const s=requestIdleCallback((...n)=>{this.signal.aborted||e(...n)},r);return this.onInvalidated(()=>cancelIdleCallback(s)),s}addEventListener(e,r,s,n){r==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),e.addEventListener?.(r.startsWith("wxt:")?k(r):r,s,{...n,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Z.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:I.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){const r=e.data?.type===I.SCRIPT_STARTED_MESSAGE_TYPE,s=e.data?.contentScriptName===this.contentScriptName,n=!this.receivedMessageIds.has(e.data?.messageId);return r&&s&&n}listenForNewerScripts(e){let r=!0;const s=n=>{if(this.verifyScriptStartedEvent(n)){this.receivedMessageIds.add(n.data.messageId);const i=r;if(r=!1,i&&e?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",s),this.onInvalidated(()=>removeEventListener("message",s))}}function pt(){}function C(t,...e){}const et={debug:(...t)=>C(console.debug,...t),log:(...t)=>C(console.log,...t),warn:(...t)=>C(console.warn,...t),error:(...t)=>C(console.error,...t)};return(async()=>{try{const{main:t,...e}=X,r=new I("reCaptcha_audio",e);return await t(r)}catch(t){throw et.error('The content script "reCaptcha_audio" crashed on startup!',t),t}})()}();
recaptchaaudio;
