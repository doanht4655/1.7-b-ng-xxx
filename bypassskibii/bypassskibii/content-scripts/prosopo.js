var prosopo=function(){"use strict";function Yt(t){return t}const et=!1,Y={equals:(t,e)=>t===e};let nt=G;const C=1,T=2;var A=null;let B=null,st=null,f=null,p=null,b=null,I=0;function $(t,e){e=e?Object.assign({},Y,e):Y;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},s=o=>(typeof o=="function"&&(o=o(n.value)),_(n,o));return[rt.bind(n),s]}function ot(t){if(f===null)return t();const e=f;f=null;try{return t()}finally{f=e}}function rt(){if(this.sources&&this.state)if(this.state===C)W(this);else{const t=p;p=null,M(()=>q(this)),p=t}if(f){const t=this.observers?this.observers.length:0;f.sources?(f.sources.push(this),f.sourceSlots.push(t)):(f.sources=[this],f.sourceSlots=[t]),this.observers?(this.observers.push(f),this.observerSlots.push(f.sources.length-1)):(this.observers=[f],this.observerSlots=[f.sources.length-1])}return this.value}function _(t,e,n){let s=t.value;return(!t.comparator||!t.comparator(s,e))&&(t.value=e,t.observers&&t.observers.length&&M(()=>{for(let o=0;o<t.observers.length;o+=1){const r=t.observers[o],i=B&&B.running;i&&B.disposed.has(r),(i?!r.tState:!r.state)&&(r.pure?p.push(r):b.push(r),r.observers&&V(r)),i||(r.state=C)}if(p.length>1e6)throw p=[],new Error})),e}function W(t){if(!t.fn)return;R(t);const e=I;it(t,t.value,e)}function it(t,e,n){let s;const o=A,r=f;f=A=t;try{s=t.fn(e)}catch(i){return t.pure&&(t.state=C,t.owned&&t.owned.forEach(R),t.owned=null),t.updatedAt=n+1,H(i)}finally{f=r,A=o}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?_(t,s):t.value=s,t.updatedAt=n)}function j(t){if(t.state===0)return;if(t.state===T)return q(t);if(t.suspense&&ot(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<I);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===C)W(t);else if(t.state===T){const s=p;p=null,M(()=>q(t,e[0])),p=s}}function M(t,e){if(p)return t();let n=!1;p=[],b?n=!0:b=[],I++;try{const s=t();return ct(n),s}catch(s){n||(b=null),p=null,H(s)}}function ct(t){if(p&&(G(p),p=null),t)return;const e=b;b=null,e.length&&M(()=>nt(e))}function G(t){for(let e=0;e<t.length;e++)j(t[e])}function q(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const s=t.sources[n];if(s.sources){const o=s.state;o===C?s!==e&&(!s.updatedAt||s.updatedAt<I)&&j(s):o===T&&q(s,e)}}}function V(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=T,n.pure?p.push(n):b.push(n),n.observers&&V(n))}}function R(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),s=t.sourceSlots.pop(),o=n.observers;if(o&&o.length){const r=o.pop(),i=n.observerSlots.pop();s<o.length&&(r.sourceSlots[i]=s,o[s]=r,n.observerSlots[s]=i)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)R(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)R(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function at(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function H(t,e=A){throw at(t)}async function lt(t,e,n){if(!t()||t().enabled===!1||t().options[n].active===!1)return!1;function s(h){return h.replace(/^https?:\/\/(www\.)?/,"")}const o=e(),r=s(o);return!t().blacklist.some(h=>{const c=s(h);return r===c})}const ut="1.3.0",dt=(t,e)=>{const n=document.createElement("div");n.style.cssText="position:fixed;top:8%;left:0;background-color:rgba(0,0,0,.6);padding:2px;color:#fff;font:calc(14px + .5vw) 'Arial',sans-serif;font-weight:bold;text-transform:uppercase;letter-spacing:1px;z-index:9999;transition:all 1s;animation:slideIn 1s forwards",n.innerHTML=`<p>${t}. Retrying in..<span id="countdown">${e}</span></p>`,document.body.appendChild(n),(()=>{const r=document.getElementById("countdown");if(!r)return;let i=e;const h=setInterval(()=>{i--,r.textContent=i,i<=0&&clearInterval(h)},1e3)})();const o=document.createElement("style");o.innerHTML="@keyframes slideIn{0%{transform:translateX(-100%)}100%{transform:translateX(0)}}@keyframes slideOut{0%{transform:translateX(0)}100%{transform:translateX(100%)}}",document.head.appendChild(o),setTimeout(()=>{n.style.animation="slideOut 1s forwards",setTimeout(()=>{document.body.removeChild(n)},1e3)},e*1e3)},E=t=>document.querySelector(t),z=t=>document.querySelectorAll(t);function J(){return E(".task-answers")!==null}function Q(){return z(".task-image .image").length===9}function Z(){return E(".bounding-box-example")!==null}function ft(){return E(".challenge-header")!==null&&E(".bounding-box-example")===null&&E(".task-grid")==null}function ht(){const t=document.body.getBoundingClientRect();return t?.width===0||t?.height===0?!1:document.querySelector("div.check")!==null}function y(t){return new Promise(e=>setTimeout(e,t))}function pt(t,e){return Math.floor(Math.random()*(e-t)+t)}function mt(){try{const t=document.querySelector("div.check");return t&&t.style.display==="block"}catch(t){return console.error(t),!1}}async function gt(t){const e=await(await fetch(t,{headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.7","accept-language":"en-US,en;q=0.9","cache-control":"max-age=0","if-modified-since":"Mon, 11 Dec 2023 02:26:04 GMT","if-none-match":'"CFDAD5AA0CE4A3068FF1CABAC59E4D9D"',priority:"u=0, i","sec-ch-ua":'"Chromium";v="130", "Google Chrome";v="130", "Not?A_Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"document","sec-fetch-mode":"navigate","sec-fetch-site":"none","sec-fetch-user":"?1","upgrade-insecure-requests":"1"},referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors"})).blob();return await wt(e)}async function wt(t){return new Promise(e=>{const n=new FileReader;n.readAsDataURL(t),n.addEventListener("loadend",()=>{const s=n.result.replace(/^data:image\/(png|jpeg);base64,/,"");e(s)}),n.addEventListener("error",()=>{logs&&console.log("❌ Failed to convert url to base64")})})}async function K(t){const e=await(await fetch(t)).blob();return new Promise(n=>{const s=new FileReader;s.readAsDataURL(e),s.addEventListener("loadend",()=>{n(s.result.replace(/^data:image\/(png|jpeg|webp);base64,/,""))}),s.addEventListener("error",()=>{logs&&console.log("❌ Failed to convert url to base64")})})}function vt(){document.querySelectorAll("iframe").forEach(e=>{e.src=e.src})}async function bt(){Z()?(await y(200),document.querySelector(".display-language.button").click(),await y(100),document.querySelector(".language-selector .option:nth-child(23)").click()):Q()?(await y(100),document.querySelector(".language-selector .option:nth-child(23)").click()):J()&&(document.querySelector(".display-language.button").click(),await y(200),document.querySelector(".language-selector .option:nth-child(23)").click(),await y(200))}function Et(){document.querySelector(".button-submit").click()}async function yt(){const t=navigator.userAgent;let e,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],`IE ${e[1]||""}`):n[1]==="Chrome"&&(e=t.match(/\b(OPR|Edge)\/(\d+)/),e!=null)?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],(e=t.match(/version\/(\d+)/i))!=null&&n.splice(1,1,e[1]),{version:n,platform:navigator.platform})}function St(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function D(t){["mouseover","mousedown","mouseup","click"].forEach(e=>{if(t.fireEvent)t.fireEvent("on"+e);else{const n=document.createEvent("MouseEvents");n.initEvent(e,!0,!1),t.dispatchEvent(n)}})}function L(t,e,n,s,o,r,i){t.dispatchEvent(new MouseEvent(e,{bubbles:!0,clientX:n,clientY:s,buttons:o,button:r,pressure:i}))}async function Ct(t,e){const n=document.querySelector("canvas");if(t!==void 0)for(const{from:s,to:o}of t)if(console.log("Coordinates from:",s,"to:",o),Array.isArray(s)&&s.length!==0&&Array.isArray(o)&&o.length!==0){const[r,i]=s,[h,c]=o,l=n.getBoundingClientRect(),u=r+l.left,d=i+l.top,m=h+l.left,a=c+l.top;L(n,"mousedown",u,d,1,0,1),await new Promise(S=>setTimeout(S,e));const w=m-u,g=a-d,x=Math.sqrt(w**2+g**2),v=Math.round(x/6),N=w/v,Lt=g/v;for(let S=1;S<=v;S++){const Ut=u+N*S,Xt=d+Lt*S;L(n,"mousemove",Ut,Xt,1,0,1),await new Promise(Nt=>setTimeout(Nt,50))}L(n,"mouseup",m,a,0,0,0)}else k.$(".button-submit").click();else k.$(".button-submit").click()}async function kt(t){function e(r,i,h){console.log("clickedOn Canvas");const c=r.getBoundingClientRect(),l=["mouseover","mousedown","mouseup","click"],u={clientX:i+c.left,clientY:h+c.top,bubbles:!0};for(let d=0;d<l.length;d++){const m=new MouseEvent(l[d],u);r.dispatchEvent(m)}}const n=document.querySelector("canvas");n.addEventListener("mousedown",r=>{const i=n.getBoundingClientRect();event.clientX-i.left,event.clientY-i.top});const[s,o]=t;e(n,s,o),await k.sleep(2e3)}async function xt(t,e){const n=(await chrome.storage.local.get("customEndpoint")).customEndpoint;return e==="custom"?`https://${n}/${t}`:`https://${e}.nocaptchaai.com/${t}`}async function Tt(t){for(const e of t){const n=[...document.querySelectorAll(".answer-text")].find(s=>s.outerText===e);D(n),[...document.querySelectorAll(".answer-example")].some(s=>s.style.backgroundColor==="rgb(116, 116, 116)")||D(n)}}async function At(){const t=document.querySelector("canvas");if(!t)return null;const[e,n]=[t.width,t.height],o=t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e,n);if((a=>{const w=a.data;for(let g=0;g<w.length;g+=4){const x=w[g],v=w[g+1],N=w[g+2];if(x!==v||v!==N)return!1}return!0})(o))return null;const i=parseInt(t.style.width,10),h=parseInt(t.style.height,10);if(i<=0||h<=0)return null;const c=Math.min(i/e,h/n),[l,u]=[e*c,n*c],d=document.createElement("canvas");return Object.assign(d,{width:l,height:u}),d.getContext("2d").drawImage(t,0,0,e,n,0,0,l,u),d.toDataURL("image/jpeg").replace(/^data:image\/(png|jpeg);base64,/,"")}function It(t){return[...document.querySelectorAll(`${t}`)].map(e=>e.style.backgroundImage.replace(/url\("|"\)/g,""))}function Mt(t){return Promise.all(t.map(async(e,n)=>(t[n]=await K(e),t[n])))}async function qt(t,e,n){const s=t.getBoundingClientRect(),o=s.left+window.scrollX,r=s.top+window.scrollY,i=o+e,h=r+n,c=new MouseEvent("mousedown",{clientX:o,clientY:r,bubbles:!0});t.dispatchEvent(c),await new Promise(a=>setTimeout(a,1e3));const l=5,u=(i-o)/l,d=(h-r)/l;for(let a=1;a<=l;a++){const w=o+u*a,g=r+d*a,x=new MouseEvent("mousemove",{clientX:w,clientY:g,bubbles:!0});t.dispatchEvent(x),await new Promise(v=>setTimeout(v,150))}await k.sleep(1e3);const m=new MouseEvent("mouseup",{clientX:i,clientY:h,bubbles:!0});t.dispatchEvent(m),await new Promise(a=>setTimeout(a,2e3))}async function Rt(t,e,n){try{const o=await(await fetch(t,{method:"POST",headers:n,body:JSON.stringify(e)})).json();if(o.error&&o.error.includes("Daily limit exhausted.")){chrome.runtime.sendMessage({action:"Daily limit exhausted!"}),stop=!0;return}if(o.errorCode==="ERROR_ZERO_BALANCE"){chrome.runtime.sendMessage({action:"Insufficient Balance!"}),stop=!0;return}if(o.error&&o.error.includes("Wallet limit exhausted.")){chrome.runtime.sendMessage({action:"Wallet limit exhausted."}),stop=!0;return}return o}catch(s){throw console.error("Error fetching coordinates:",s),s}}async function Ot(t){return new Promise(e=>{chrome.runtime.sendMessage({type:"GET_IMAGE_BASE64",payload:{url:t}},n=>{n?.success?e(n.data):e(null)})})}const k={version:ut,$:E,$$:z,isMulti:J,isGrid:Q,isBbox:Z,isBboxDD:ft,isWidget:ht,sleep:y,randTimer:pt,isSolved:mt,countdownNotif:dt,getBase64FromUrl:K,refreshIframes:vt,getEn:bt,skip:Et,getBrowser:yt,shuffle:St,fireMouseEvents:D,getCanvas:kt,handleCanvasDD:Ct,getApi:xt,clickMatchingElement:Tt,sliceOG:At,updateExamples:Mt,getExamples:It,solveGeetestCaptcha:qt,sendCoordinatesRequest:Rt,geeFetchImage:gt,fetchBase64Image:Ot},Pt={matches:["<all_urls>"],allFrames:!0,async main(){let t;try{t=window.top.document.location.href}catch{t=window.location.href}const[e]=$(t),[n,s]=$(await chrome.storage.local.get("settings"));if(s(n().settings),!await lt(n,e,"ProSOPO"))return;let i=!0;if(window._prosopo)return;for(window._prosopo=!0;i===!1;){await k.sleep(2e3);const c=document.querySelector("prosopo-procaptcha");if(c&&c.shadowRoot){const u=c.shadowRoot.querySelector("input[type='checkbox']");document.querySelector("img");const d=document.querySelector(".prosopo-modalOuter");let m=!1;if(d&&(m=getComputedStyle(d).display==="flex"),!m&&u&&n()?.options.ProSOPO.autoOpen===!0){console.log(m,"checkbox clicked"),h(u);const a=document.createElement("script");a.src=chrome.runtime.getURL("themes/proso.js"),(document.head||document.documentElement).appendChild(a)}}}function h(c){if(!c)return;const l=getComputedStyle(c).appearance;if(console.log("Checking appearance:",l,typeof l),l!=="auto"){console.log("clicking on checkbox..........................");const u=c.getBoundingClientRect(),d=u.left+u.width*(.4+Math.random()*.2),m=u.top+u.height*(.4+Math.random()*.2),a={bubbles:!0,cancelable:!0,view:window,clientX:d,clientY:m};setTimeout(()=>{c.dispatchEvent(new PointerEvent("pointerdown",a)),c.dispatchEvent(new PointerEvent("pointerup",a)),c.dispatchEvent(new MouseEvent("click",a))},200+Math.random()*300)}}}},tt=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;function O(t,...e){}const Ft={debug:(...t)=>O(console.debug,...t),log:(...t)=>O(console.log,...t),warn:(...t)=>O(console.warn,...t),error:(...t)=>O(console.error,...t)};class U extends Event{constructor(e,n){super(U.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=n}static EVENT_NAME=X("wxt:locationchange")}function X(t){return`${tt?.runtime?.id}:prosopo:${t}`}function Bt(t){let e,n;return{run(){e==null&&(n=new URL(location.href),e=t.setInterval(()=>{let s=new URL(location.href);s.href!==n.href&&(window.dispatchEvent(new U(s,n)),n=s)},1e3))}}}class P{constructor(e,n){this.contentScriptName=e,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}static SCRIPT_STARTED_MESSAGE_TYPE=X("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=Bt(this);receivedMessageIds=new Set;get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return tt.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,n){const s=setInterval(()=>{this.isValid&&e()},n);return this.onInvalidated(()=>clearInterval(s)),s}setTimeout(e,n){const s=setTimeout(()=>{this.isValid&&e()},n);return this.onInvalidated(()=>clearTimeout(s)),s}requestAnimationFrame(e){const n=requestAnimationFrame((...s)=>{this.isValid&&e(...s)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(e,n){const s=requestIdleCallback((...o)=>{this.signal.aborted||e(...o)},n);return this.onInvalidated(()=>cancelIdleCallback(s)),s}addEventListener(e,n,s,o){n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),e.addEventListener?.(n.startsWith("wxt:")?X(n):n,s,{...o,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Ft.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:P.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){const n=e.data?.type===P.SCRIPT_STARTED_MESSAGE_TYPE,s=e.data?.contentScriptName===this.contentScriptName,o=!this.receivedMessageIds.has(e.data?.messageId);return n&&s&&o}listenForNewerScripts(e){let n=!0;const s=o=>{if(this.verifyScriptStartedEvent(o)){this.receivedMessageIds.add(o.data.messageId);const r=n;if(n=!1,r&&e?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",s),this.onInvalidated(()=>removeEventListener("message",s))}}function Wt(){}function F(t,...e){}const Dt={debug:(...t)=>F(console.debug,...t),log:(...t)=>F(console.log,...t),warn:(...t)=>F(console.warn,...t),error:(...t)=>F(console.error,...t)};return(async()=>{try{const{main:t,...e}=Pt,n=new P("prosopo",e);return await t(n)}catch(t){throw Dt.error('The content script "prosopo" crashed on startup!',t),t}})()}();
prosopo;
